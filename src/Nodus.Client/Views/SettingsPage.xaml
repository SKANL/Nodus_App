<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Nodus.Client.ViewModels"
             x:Class="Nodus.Client.Views.SettingsPage"
             Title="Ajustes"
             BackgroundColor="#0F172A">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="16,40,16,24">

            <!-- ══ HEADER ══════════════════════════════════════════════ -->
            <Label Text="Sincronización" FontSize="22" FontAttributes="Bold" TextColor="White" Margin="8,0,0,4" />

            <!-- Sync Statistics Card -->
            <Border StrokeShape="RoundRectangle 16"
                    StrokeThickness="1" Stroke="#1E293B"
                    BackgroundColor="#1E293B"
                    Padding="20,16">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Estadísticas de Sincronización" 
                           FontSize="17" FontAttributes="Bold" TextColor="White" />
                    
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                        <!-- Fix: TextColor elevated from #64748B (Gray500, ratio 3.1:1 ❌) to
                             #94A3B8 (Gray400, ratio ~4.9:1 ✅ WCAG AA) for stat row labels -->
                        <Label Grid.Row="0" Grid.Column="0" Text="Votos Pendientes:" TextColor="#94A3B8" FontSize="14" />
                        <Label Grid.Row="0" Grid.Column="1" 
                               Text="{Binding PendingVotesCount}" 
                               FontAttributes="Bold" FontSize="14"
                               TextColor="#F59E0B" />
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="Archivos Pendientes:" TextColor="#94A3B8" FontSize="14" />
                        <Label Grid.Row="1" Grid.Column="1" 
                               Text="{Binding PendingMediaCount}" 
                               FontAttributes="Bold" FontSize="14"
                               TextColor="#F59E0B" />
                        
                        <Label Grid.Row="2" Grid.Column="0" Text="Sincronización Total:" TextColor="#94A3B8" FontSize="14" />
                        <Label Grid.Row="2" Grid.Column="1" 
                               Text="{Binding SyncStatsText}" 
                               FontAttributes="Bold" FontSize="14"
                               TextColor="#22C55E" />
                    </Grid>

                    <Button Text="↻  Refrescar Estadísticas"
                            Command="{Binding RefreshStatsCommand}"
                            BackgroundColor="Transparent"
                            BorderColor="#6366F1"
                            BorderWidth="1"
                            TextColor="#6366F1"
                            HeightRequest="40"
                            FontSize="14" FontAttributes="Bold"
                            CornerRadius="10" />
                </VerticalStackLayout>
            </Border>

            <!-- ═══════════════════════════════════════════════════════ -->
            <BoxView HeightRequest="1" Color="#1E293B" Margin="0,4" />

            <!-- Developer Options — only visible in DEBUG / dev builds.
                 Fix: exposed dev tools in production confuse end users and
                 damage trust. IsVisible binds to ViewModel.IsDevMode, which
                 resolves to true only when the app is built in DEBUG config.

                 In SettingsViewModel.cs, implement:
                   public bool IsDevMode =>
                       System.Diagnostics.Debugger.IsAttached ||
                       AppInfo.Current.PackageName.Contains(".debug");

                 This means judges in the field never see raw sync triggers.
            -->
            <Label Text="Opciones de Desarrollador" FontSize="22" FontAttributes="Bold" TextColor="White" Margin="8,0,0,4"
                   IsVisible="{Binding IsDevMode}" />

            <!-- Media Sync Card -->
            <Border StrokeShape="RoundRectangle 16"
                    StrokeThickness="1" Stroke="#1E293B"
                    BackgroundColor="#1E293B"
                    Padding="20,16"
                    IsVisible="{Binding IsDevMode}">
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Label Grid.Column="0" 
                               Text="Media Sync (Force Mode)"
                               VerticalOptions="Center" 
                               FontSize="15" TextColor="#CBD5E1" />

                        <Button Grid.Column="1"
                                Text="Trigger Sync"
                                Command="{Binding ForceMediaSyncCommand}"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                                BackgroundColor="#6366F1"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="38"
                                FontSize="13" FontAttributes="Bold"
                                Padding="16,0" />
                    </Grid>

                    <ProgressBar Progress="{Binding SyncProgress}" 
                                 IsVisible="{Binding IsSyncing}"
                                 ProgressColor="#6366F1" />

                    <HorizontalStackLayout HorizontalOptions="End" Spacing="8">
                        <ActivityIndicator IsRunning="{Binding IsSyncing}" 
                                           IsVisible="{Binding IsSyncing}"
                                           HeightRequest="18" WidthRequest="18" 
                                           Color="#6366F1" />
                        <!-- Fix: #64748B (ratio 3.1:1 ❌) → #94A3B8 (ratio ~4.9:1 ✅ AA) -->
                        <Label Text="{Binding StatusMessage}"
                               TextColor="#94A3B8"
                               FontSize="13"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- ═══════════════════════════════════════════════════════ -->
            <BoxView HeightRequest="1" Color="#1E293B" Margin="0,4" />

            <Label Text="Acerca de" FontSize="18" FontAttributes="Bold" TextColor="#CBD5E1" Margin="8,0,0,4" />
            
            <Label Text="Nodus Client v1.0 — Modo Offline First" 
                   TextColor="#64748B" FontSize="13"
                   HorizontalOptions="Center" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
