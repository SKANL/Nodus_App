<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Nodus.Client.ViewModels"
             x:Class="Nodus.Client.Views.VotingPage"
             Title=""
             BackgroundColor="#0F172A">

    <Grid RowDefinitions="Auto, *, Auto">

        <!-- â•â• PROJECT HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" RowDefinitions="Auto,Auto" Padding="24,52,24,20" BackgroundColor="#0F172A">
            <!-- Category pill -->
            <Border Grid.Row="0" StrokeShape="RoundRectangle 20"
                    BackgroundColor="#1E1B4B" Padding="12,6"
                    HorizontalOptions="Start">
                <Label Text="{Binding CurrentProject.Category, TargetNullValue='â€”'}"
                       TextColor="#A5B4FC" FontSize="13" FontAttributes="Bold"
                       CharacterSpacing="0.5" />
            </Border>
            <!-- Project name -->
            <Label Grid.Row="1" Text="{Binding CurrentProject.Name, TargetNullValue='Cargando...'}"
                   FontSize="26" FontAttributes="Bold" TextColor="White"
                   Margin="0,10,0,0" MaxLines="2" LineBreakMode="TailTruncation" />
        </Grid>

        <!-- â•â• SCORE FORM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="0" Padding="16,0,16,16">

                <!-- Category Sliders -->
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Categories}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="vm:CategoryScore">
                            <Border StrokeShape="RoundRectangle 16"
                                    StrokeThickness="1" Stroke="#1E293B"
                                    BackgroundColor="#1E293B"
                                    Padding="20,16" Margin="0,0,0,12">
                                <VerticalStackLayout Spacing="12">
                                    <!-- Category name + score badge -->
                                    <Grid ColumnDefinitions="*, Auto">
                                        <Label Grid.Column="0"
                                               Text="{Binding Name}"
                                               FontSize="16" FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalOptions="Center" />
                                        <Border Grid.Column="1"
                                                StrokeShape="RoundRectangle 10"
                                                BackgroundColor="#4F46E5"
                                                Padding="10,4">
                                            <Label Text="{Binding Score, StringFormat='{0:F0}'}"
                                                   FontSize="18" FontAttributes="Bold"
                                                   TextColor="White"
                                                   HorizontalOptions="Center" />
                                        </Border>
                                    </Grid>
                                    <!-- Slider -->
                                    <Slider Value="{Binding Score}"
                                            Minimum="1"
                                            Maximum="{Binding MaxScore}"
                                            MinimumTrackColor="#6366F1"
                                            MaximumTrackColor="#334155"
                                            ThumbColor="#6366F1" />
                                    <!-- Scale labels -->
                                    <Grid ColumnDefinitions="*, *">
                                        <Label Grid.Column="0" Text="Por mejorar"
                                               FontSize="10" TextColor="#475569"
                                               HorizontalOptions="Start" />
                                        <Label Grid.Column="1" Text="Excelente"
                                               FontSize="10" TextColor="#475569"
                                               HorizontalOptions="End" />
                                    </Grid>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>

                <!-- Comments Field -->
                <Border StrokeShape="RoundRectangle 16"
                        StrokeThickness="1" Stroke="#1E293B"
                        BackgroundColor="#1E293B" Padding="20,16">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ðŸ’¬  Notas (opcional)"
                               FontSize="14" FontAttributes="Bold"
                               TextColor="#94A3B8" />
                        <Editor Text="{Binding Comment}"
                                Placeholder="Escribe tus comentarios para el equipo..."
                                PlaceholderColor="#475569"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="14"
                                HeightRequest="80"
                                MaxLength="280" />
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!-- â•â• SUBMIT FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <VerticalStackLayout Grid.Row="2" Spacing="10" Padding="16,12,16,32"
                             BackgroundColor="#0F172A">
            <Label Text="{Binding StatusMessage}"
                   HorizontalOptions="Center"
                   FontSize="13"
                   TextColor="{Binding IsSubmitting, Converter={StaticResource BoolToColorConverter}}" />
            <Border StrokeShape="RoundRectangle 16"
                    BackgroundColor="#6366F1"
                    Padding="0">
                <Button Text="{Binding IsSubmitting, Converter={StaticResource BoolToSubmitTextConverter}, ConverterParameter='Enviando...|Votar âœ“'}"
                        Command="{Binding SubmitVoteCommand}"
                        IsEnabled="{Binding IsSubmitting, Converter={StaticResource InvertedBoolConverter}}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="17" FontAttributes="Bold"
                        HeightRequest="56"
                        CornerRadius="16" />
            </Border>
        </VerticalStackLayout>

    </Grid>
</ContentPage>
